import { NextResponse } from "next/server"

// 定义热门代币接口
export interface TrendingToken {
  id: string
  name: string
  symbol: string
  price: number
  priceUsd: string
  change24h: number
  volume24h: number
  volumeUsd: string
  marketCap: number
  marketCapUsd: string
  chainId: string
  chain: string
  address: string
  logo: string
  color: string
  rank: number
  trending: string
}

// 生成模拟数据
function generateMockData() {
  // 热门代币模拟数据
  const mockTrendingTokens = [
    {
      id: "bitcoin",
      name: "BTC",
      symbol: "Bitcoin",
      price: 62541.23,
      priceUsd: "$62,541.23",
      change24h: 0.62,
      volume24h: 24500000,
      volumeUsd: "$24.5M",
      marketCap: 1210000000000,
      marketCapUsd: "$1.21T",
      chainId: "1",
      chain: "ethereum",
      address: "0x2260fac5e5542a773aa44fbcfedf7c193bc2c599",
      logo: "https://assets.coingecko.com/coins/images/1/large/bitcoin.png",
      color: "#F7931A",
      rank: 1,
      trending: "up",
    },
    {
      id: "ethereum",
      name: "ETH",
      symbol: "Ethereum",
      price: 3458.92,
      priceUsd: "$3,458.92",
      change24h: 0.55,
      volume24h: 12300000000,
      volumeUsd: "$12.3B",
      marketCap: 415000000000,
      marketCapUsd: "$415B",
      chainId: "1",
      chain: "ethereum",
      address: "0xc02aaa39b223fe8d0a0e5c4f27ead9083c756cc2",
      logo: "https://assets.coingecko.com/coins/images/279/large/ethereum.png",
      color: "#627EEA",
      rank: 2,
      trending: "up",
    },
    {
      id: "binancecoin",
      name: "BNB",
      symbol: "BNB",
      price: 598.47,
      priceUsd: "$598.47",
      change24h: 0.72,
      volume24h: 1800000000,
      volumeUsd: "$1.8B",
      marketCap: 92000000000,
      marketCapUsd: "$92B",
      chainId: "56",
      chain: "binance-smart-chain",
      address: "0xbb4cdb9cbd36b01bd1cbaebf2de08d9173bc095c",
      logo: "https://assets.coingecko.com/coins/images/825/large/bnb-icon2_2x.png",
      color: "#F3BA2F",
      rank: 3,
      trending: "up",
    },
    {
      id: "solana",
      name: "SOL",
      symbol: "Solana",
      price: 142.37,
      priceUsd: "$142.37",
      change24h: 0.83,
      volume24h: 3500000000,
      volumeUsd: "$3.5B",
      marketCap: 61000000000,
      marketCapUsd: "$61B",
      chainId: "SOL",
      chain: "solana",
      address: "So11111111111111111111111111111111111111112",
      logo: "https://assets.coingecko.com/coins/images/4128/large/solana.png",
      color: "#00FFA3",
      rank: 4,
      trending: "up",
    },
    {
      id: "ripple",
      name: "XRP",
      symbol: "XRP",
      price: 0.5023,
      priceUsd: "$0.50",
      change24h: -1.25,
      volume24h: 1200000000,
      volumeUsd: "$1.2B",
      marketCap: 27000000000,
      marketCapUsd: "$27B",
      chainId: "XRP",
      chain: "ripple",
      address: "native",
      logo: "https://assets.coingecko.com/coins/images/44/large/xrp-symbol-white-128.png",
      color: "#23292F",
      rank: 5,
      trending: "down",
    },
    {
      id: "cardano",
      name: "ADA",
      symbol: "Cardano",
      price: 0.46,
      priceUsd: "$0.46",
      change24h: 1.32,
      volume24h: 890000000,
      volumeUsd: "$890M",
      marketCap: 16500000000,
      marketCapUsd: "$16.5B",
      chainId: "ADA",
      chain: "cardano",
      address: "native",
      logo: "https://assets.coingecko.com/coins/images/975/large/cardano.png",
      color: "#0033AD",
      rank: 6,
      trending: "up",
    },
    {
      id: "polkadot",
      name: "DOT",
      symbol: "Polkadot",
      price: 6.87,
      priceUsd: "$6.87",
      change24h: 1.78,
      volume24h: 750000000,
      volumeUsd: "$750M",
      marketCap: 8900000000,
      marketCapUsd: "$8.9B",
      chainId: "DOT",
      chain: "polkadot",
      address: "native",
      logo: "https://assets.coingecko.com/coins/images/12171/large/polkadot.png",
      color: "#E6007A",
      rank: 7,
      trending: "up",
    },
    {
      id: "avalanche-2",
      name: "AVAX",
      symbol: "Avalanche",
      price: 35.24,
      priceUsd: "$35.24",
      change24h: 0.98,
      volume24h: 680000000,
      volumeUsd: "$680M",
      marketCap: 12800000000,
      marketCapUsd: "$12.8B",
      chainId: "AVAX",
      chain: "avalanche",
      address: "native",
      logo: "https://assets.coingecko.com/coins/images/12559/large/Avalanche_Circle_RedWhite_Trans.png",
      color: "#E84142",
      rank: 8,
      trending: "up",
    },
    {
      id: "chainlink",
      name: "LINK",
      symbol: "Chainlink",
      price: 13.45,
      priceUsd: "$13.45",
      change24h: 2.13,
      volume24h: 940000000,
      volumeUsd: "$940M",
      marketCap: 7800000000,
      marketCapUsd: "$7.8B",
      chainId: "1",
      chain: "ethereum",
      address: "0x514910771af9ca656af840dff83e8264ecf986ca",
      logo: "https://assets.coingecko.com/coins/images/877/large/chainlink-new-logo.png",
      color: "#2A5ADA",
      rank: 9,
      trending: "up",
    },
    {
      id: "polygon",
      name: "MATIC",
      symbol: "Polygon",
      price: 0.64,
      priceUsd: "$0.64",
      change24h: -0.87,
      volume24h: 520000000,
      volumeUsd: "$520M",
      marketCap: 6300000000,
      marketCapUsd: "$6.3B",
      chainId: "137",
      chain: "polygon",
      address: "native",
      logo: "https://assets.coingecko.com/coins/images/4713/large/matic-token-icon.png",
      color: "#8247E5",
      rank: 10,
      trending: "down",
    },
    {
      id: "shiba-inu",
      name: "SHIB",
      symbol: "Shiba Inu",
      price: 0.0000236,
      priceUsd: "$0.0000236",
      change24h: 1.92,
      volume24h: 430000000,
      volumeUsd: "$430M",
      marketCap: 13900000000,
      marketCapUsd: "$13.9B",
      chainId: "1",
      chain: "ethereum",
      address: "0x95ad61b0a150d79219dcf64e1e6cc01f0b64c4ce",
      logo: "https://assets.coingecko.com/coins/images/11939/large/shiba.png",
      color: "#FFA409",
      rank: 11,
      trending: "up",
    },
    {
      id: "litecoin",
      name: "LTC",
      symbol: "Litecoin",
      price: 84.23,
      priceUsd: "$84.23",
      change24h: 0.32,
      volume24h: 310000000,
      volumeUsd: "$310M",
      marketCap: 6200000000,
      marketCapUsd: "$6.2B",
      chainId: "LTC",
      chain: "litecoin",
      address: "native",
      logo: "https://assets.coingecko.com/coins/images/2/large/litecoin.png",
      color: "#A5A8A9",
      rank: 12,
      trending: "up",
    },
    {
      id: "uniswap",
      name: "UNI",
      symbol: "Uniswap",
      price: 9.87,
      priceUsd: "$9.87",
      change24h: 1.54,
      volume24h: 280000000,
      volumeUsd: "$280M",
      marketCap: 5900000000,
      marketCapUsd: "$5.9B",
      chainId: "1",
      chain: "ethereum",
      address: "0x1f9840a85d5af5bf1d1762f925bdaddc4201f984",
      logo: "https://assets.coingecko.com/coins/images/12504/large/uniswap-uni.png",
      color: "#FF007A",
      rank: 13,
      trending: "up",
    },
    {
      id: "bitcoin-cash",
      name: "BCH",
      symbol: "Bitcoin Cash",
      price: 356.42,
      priceUsd: "$356.42",
      change24h: 0.78,
      volume24h: 250000000,
      volumeUsd: "$250M",
      marketCap: 6900000000,
      marketCapUsd: "$6.9B",
      chainId: "BCH",
      chain: "bitcoin-cash",
      address: "native",
      logo: "https://assets.coingecko.com/coins/images/780/large/bitcoin-cash-circle.png",
      color: "#8DC351",
      rank: 14,
      trending: "up",
    },
    {
      id: "stellar",
      name: "XLM",
      symbol: "Stellar",
      price: 0.11,
      priceUsd: "$0.11",
      change24h: -0.43,
      volume24h: 180000000,
      volumeUsd: "$180M",
      marketCap: 3100000000,
      marketCapUsd: "$3.1B",
      chainId: "XLM",
      chain: "stellar",
      address: "native",
      logo: "https://assets.coingecko.com/coins/images/100/large/Stellar_symbol_black_RGB.png",
      color: "#7D00FF",
      rank: 15,
      trending: "down",
    },
    {
      id: "tron",
      name: "TRX",
      symbol: "TRON",
      price: 0.12,
      priceUsd: "$0.12",
      change24h: 0.62,
      volume24h: 220000000,
      volumeUsd: "$220M",
      marketCap: 11200000000,
      marketCapUsd: "$11.2B",
      chainId: "TRX",
      chain: "tron",
      address: "native",
      logo: "https://assets.coingecko.com/coins/images/1094/large/tron-logo.png",
      color: "#FF0013",
      rank: 16,
      trending: "up",
    },
    {
      id: "filecoin",
      name: "FIL",
      symbol: "Filecoin",
      price: 4.98,
      priceUsd: "$4.98",
      change24h: 1.23,
      volume24h: 140000000,
      volumeUsd: "$140M",
      marketCap: 2300000000,
      marketCapUsd: "$2.3B",
      chainId: "FIL",
      chain: "filecoin",
      address: "native",
      logo: "https://assets.coingecko.com/coins/images/12817/large/filecoin.png",
      color: "#0090FF",
      rank: 17,
      trending: "up",
    },
    {
      id: "monero",
      name: "XMR",
      symbol: "Monero",
      price: 166.32,
      priceUsd: "$166.32",
      change24h: -1.67,
      volume24h: 120000000,
      volumeUsd: "$120M",
      marketCap: 3000000000,
      marketCapUsd: "$3.0B",
      chainId: "XMR",
      chain: "monero",
      address: "native",
      logo: "https://assets.coingecko.com/coins/images/69/large/monero_logo.png",
      color: "#FF6600",
      rank: 18,
      trending: "down",
    },
    {
      id: "cosmos",
      name: "ATOM",
      symbol: "Cosmos",
      price: 8.76,
      priceUsd: "$8.76",
      change24h: 0.89,
      volume24h: 150000000,
      volumeUsd: "$150M",
      marketCap: 3300000000,
      marketCapUsd: "$3.3B",
      chainId: "ATOM",
      chain: "cosmos",
      address: "native",
      logo: "https://assets.coingecko.com/coins/images/1481/large/cosmos_hub.png",
      color: "#2E3148",
      rank: 19,
      trending: "up",
    },
    {
      id: "near",
      name: "NEAR",
      symbol: "NEAR Protocol",
      price: 4.21,
      priceUsd: "$4.21",
      change24h: 1.78,
      volume24h: 170000000,
      volumeUsd: "$170M",
      marketCap: 4200000000,
      marketCapUsd: "$4.2B",
      chainId: "NEAR",
      chain: "near",
      address: "native",
      logo: "https://assets.coingecko.com/coins/images/10365/large/near.jpg",
      color: "#000000",
      rank: 20,
      trending: "up",
    },
    {
      id: "aave",
      name: "AAVE",
      symbol: "Aave",
      price: 92.15,
      priceUsd: "$92.15",
      change24h: 2.13,
      volume24h: 110000000,
      volumeUsd: "$110M",
      marketCap: 1400000000,
      marketCapUsd: "$1.4B",
      chainId: "1",
      chain: "ethereum",
      address: "0x7fc66500c84a76ad7e9c93437bfc5ac33e2ddae9",
      logo: "https://assets.coingecko.com/coins/images/12645/large/AAVE.png",
      color: "#B6509E",
      rank: 21,
      trending: "up",
    },
    {
      id: "maker",
      name: "MKR",
      symbol: "Maker",
      price: 1689.34,
      priceUsd: "$1,689.34",
      change24h: 0.43,
      volume24h: 90000000,
      volumeUsd: "$90M",
      marketCap: 1500000000,
      marketCapUsd: "$1.5B",
      chainId: "1",
      chain: "ethereum",
      address: "0x9f8f72aa9304c8b593d555f12ef6589cc3a579a2",
      logo: "https://assets.coingecko.com/coins/images/1364/large/Mark_Maker.png",
      color: "#6ACEBB",
      rank: 22,
      trending: "up",
    },
    {
      id: "the-graph",
      name: "GRT",
      symbol: "The Graph",
      price: 0.17,
      priceUsd: "$0.17",
      change24h: -1.21,
      volume24h: 80000000,
      volumeUsd: "$80M",
      marketCap: 1600000000,
      marketCapUsd: "$1.6B",
      chainId: "1",
      chain: "ethereum",
      address: "0xc944e90c64b2c07662a292be6244bdf05cda44a7",
      logo: "https://assets.coingecko.com/coins/images/13397/large/Graph_Token.png",
      color: "#6747ED",
      rank: 23,
      trending: "down",
    },
    {
      id: "algorand",
      name: "ALGO",
      symbol: "Algorand",
      price: 0.18,
      priceUsd: "$0.18",
      change24h: 0.68,
      volume24h: 70000000,
      volumeUsd: "$70M",
      marketCap: 1400000000,
      marketCapUsd: "$1.4B",
      chainId: "ALGO",
      chain: "algorand",
      address: "native",
      logo: "https://assets.coingecko.com/coins/images/4380/large/download.png",
      color: "#000000",
      rank: 24,
      trending: "up",
    },
    {
      id: "fantom",
      name: "FTM",
      symbol: "Fantom",
      price: 0.46,
      priceUsd: "$0.46",
      change24h: 1.56,
      volume24h: 85000000,
      volumeUsd: "$85M",
      marketCap: 1300000000,
      marketCapUsd: "$1.3B",
      chainId: "FTM",
      chain: "fantom",
      address: "native",
      logo: "https://assets.coingecko.com/coins/images/4001/large/Fantom_round.png",
      color: "#1969FF",
      rank: 25,
      trending: "up",
    },
    {
      id: "optimism",
      name: "OP",
      symbol: "Optimism",
      price: 3.12,
      priceUsd: "$3.12",
      change24h: 2.36,
      volume24h: 160000000,
      volumeUsd: "$160M",
      marketCap: 2900000000,
      marketCapUsd: "$2.9B",
      chainId: "10",
      chain: "optimism",
      address: "native",
      logo: "https://assets.coingecko.com/coins/images/25244/large/Optimism.png",
      color: "#FF0420",
      rank: 26,
      trending: "up",
    },
    {
      id: "arbitrum",
      name: "ARB",
      symbol: "Arbitrum",
      price: 1.26,
      priceUsd: "$1.26",
      change24h: 1.89,
      volume24h: 180000000,
      volumeUsd: "$180M",
      marketCap: 4100000000,
      marketCapUsd: "$4.1B",
      chainId: "42161",
      chain: "arbitrum",
      address: "native",
      logo: "https://assets.coingecko.com/coins/images/16547/large/photo_2023-03-29_21.47.00.jpeg",
      color: "#28A0F0",
      rank: 27,
      trending: "up",
    },
    {
      id: "apecoin",
      name: "APE",
      symbol: "ApeCoin",
      price: 1.38,
      priceUsd: "$1.38",
      change24h: -2.14,
      volume24h: 95000000,
      volumeUsd: "$95M",
      marketCap: 1700000000,
      marketCapUsd: "$1.7B",
      chainId: "1",
      chain: "ethereum",
      address: "0x4d224452801aced8b2f0aebe155379bb5d594381",
      logo: "https://assets.coingecko.com/coins/images/24383/large/apecoin.jpg",
      color: "#0057FF",
      rank: 28,
      trending: "down",
    },
    {
      id: "immutable-x",
      name: "IMX",
      symbol: "Immutable X",
      price: 2.64,
      priceUsd: "$2.64",
      change24h: 3.21,
      volume24h: 130000000,
      volumeUsd: "$130M",
      marketCap: 3500000000,
      marketCapUsd: "$3.5B",
      chainId: "1",
      chain: "ethereum",
      address: "0xf57e7e7c23978c3caec3c3548e3d615c346e79ff",
      logo: "https://assets.coingecko.com/coins/images/17233/large/immutableX-symbol-BLK-RGB.png",
      color: "#FF47CC",
      rank: 29,
      trending: "up",
    },
    {
      id: "render-token",
      name: "RNDR",
      symbol: "Render Token",
      price: 7.21,
      priceUsd: "$7.21",
      change24h: 2.88,
      volume24h: 140000000,
      volumeUsd: "$140M",
      marketCap: 2800000000,
      marketCapUsd: "$2.8B",
      chainId: "1",
      chain: "ethereum",
      address: "0x6de037ef9ad2725eb40118bb1702ebb27e4aeb24",
      logo: "https://assets.coingecko.com/coins/images/11636/large/rndr.png",
      color: "#5B26C8",
      rank: 30,
      trending: "up",
    },
  ]

  // 新上线代币模拟数据
  const mockNewListings = [
    {
      id: "sui",
      name: "SUI",
      symbol: "Sui",
      price: 1.38,
      priceUsd: "$1.38",
      change24h: 5.62,
      volume24h: 450000000,
      volumeUsd: "$450M",
      marketCap: 1500000000,
      marketCapUsd: "$1.5B",
      chainId: "SUI",
      chain: "sui",
      address: "native",
      logo: "https://assets.coingecko.com/coins/images/26375/large/sui_asset.jpeg",
      color: "#6B46C1",
      rank: 48,
      trending: "up",
    },
    {
      id: "sei-network",
      name: "SEI",
      symbol: "Sei Network",
      price: 0.75,
      priceUsd: "$0.75",
      change24h: 3.25,
      volume24h: 320000000,
      volumeUsd: "$320M",
      marketCap: 750000000,
      marketCapUsd: "$750M",
      chainId: "SEI",
      chain: "sei",
      address: "native",
      logo: "https://assets.coingecko.com/coins/images/28205/large/Sei_Logo_-_Transparent.png",
      color: "#FF5CAA",
      rank: 68,
      trending: "up",
    },
    {
      id: "blast-token",
      name: "BLAST",
      symbol: "Blast",
      price: 0.62,
      priceUsd: "$0.62",
      change24h: 7.84,
      volume24h: 220000000,
      volumeUsd: "$220M",
      marketCap: 550000000,
      marketCapUsd: "$550M",
      chainId: "blast",
      chain: "ethereum",
      address: "0x3e0437c95ef358e95b24a4347cef6c3d1ab3eff3",
      logo: "https://assets.coingecko.com/coins/images/35299/large/blast.jpeg",
      color: "#FF5700",
      rank: 92,
      trending: "up",
    }
  ]

  // 高交易量代币模拟数据
  const mockHighVolume = [
    {
      id: "tether",
      name: "USDT",
      symbol: "Tether",
      price: 0.9998,
      priceUsd: "$1.00",
      change24h: 0.01,
      volume24h: 64000000000,
      volumeUsd: "$64B",
      marketCap: 102000000000,
      marketCapUsd: "$102B",
      chainId: "1",
      chain: "ethereum",
      address: "0xdac17f958d2ee523a2206206994597c13d831ec7",
      logo: "https://assets.coingecko.com/coins/images/325/large/Tether.png",
      color: "#26A17B",
      rank: 6,
      trending: "stable",
    },
    {
      id: "usd-coin",
      name: "USDC",
      symbol: "USD Coin",
      price: 1.0001,
      priceUsd: "$1.00",
      change24h: 0.02,
      volume24h: 42000000000,
      volumeUsd: "$42B",
      marketCap: 34000000000,
      marketCapUsd: "$34B",
      chainId: "1",
      chain: "ethereum",
      address: "0xa0b86991c6218b36c1d19d4a2e9eb0ce3606eb48",
      logo: "https://assets.coingecko.com/coins/images/6319/large/usdc.png",
      color: "#2775CA",
      rank: 8,
      trending: "stable",
    },
    {
      id: "dogecoin",
      name: "DOGE",
      symbol: "Dogecoin",
      price: 0.1521,
      priceUsd: "$0.15",
      change24h: 1.87,
      volume24h: 36000000000,
      volumeUsd: "$36B",
      marketCap: 21000000000,
      marketCapUsd: "$21B",
      chainId: "DOGE",
      chain: "dogecoin",
      address: "native",
      logo: "https://assets.coingecko.com/coins/images/5/large/dogecoin.png",
      color: "#C2A633",
      rank: 12,
      trending: "up",
    }
  ]

  return {
    trending: mockTrendingTokens,
    newListings: mockNewListings,
    highVolume: mockHighVolume,
    lastUpdated: new Date().toISOString()
  }
}

// 获取热门代币列表
export async function GET() {
  try {
    // 从 crypto API 获取热门代币
    const response = await fetch("http://localhost:3003/api/crypto", {
      method: "GET",
      headers: {
        Accept: "application/json",
        "Cache-Control": "no-cache",
      },
    })

    if (!response.ok) {
      throw new Error(`API返回错误: ${response.status}`)
    }

    const data = await response.json()
    
    // 转换数据格式
    let trendingTokens: TrendingToken[] = []
    let newListings: TrendingToken[] = []
    let highVolume: TrendingToken[] = []

    if (data.success && data.data) {
      // 从 popularTokens 生成主要趋势代币列表
      trendingTokens = data.data.popularTokens.map((token: any, index: number) => ({
        id: token.id,
        name: token.name,
        symbol: token.symbol,
        price: token.price,
        priceUsd: `$${token.price.toLocaleString()}`,
        change24h: token.change,
        volume24h: 10000000 + Math.random() * 10000000,
        volumeUsd: `$${(10 + Math.random() * 20).toFixed(2)}M`,
        marketCap: 1000000000 + Math.random() * 10000000000,
        marketCapUsd: `$${(1 + Math.random() * 10).toFixed(2)}B`,
        chainId: "1",
        chain: "ethereum",
        address: `0x${Math.random().toString(16).substring(2, 42)}`,
        logo: `https://assets.coingecko.com/coins/images/${Math.floor(Math.random() * 20) + 1}/large/coin.png`,
        color: token.color,
        rank: index + 1,
        trending: Math.random() > 0.5 ? "up" : "down"
      }))

      // 确保我们有30个热门代币
      // 如果 API 返回的代币数少于 30 个，使用 trendingTokens 和模拟数据补充
      if (trendingTokens.length < 30) {
        const mockData = generateMockData();
        const requiredExtraTokens = 30 - trendingTokens.length;
        
        // 使用模拟数据中的代币来补充列表
        const extraTokens = mockData.trending
          .filter(token => !trendingTokens.some(t => t.id === token.id))
          .slice(0, requiredExtraTokens)
          .map((token, index) => ({
            ...token,
            rank: trendingTokens.length + index + 1 // 确保 rank 是连续的
          }));
        
        trendingTokens = [...trendingTokens, ...extraTokens];
      }

      // 从 trendingTokens 生成新上线列表和高交易量列表
      if (data.data.trendingTokens && data.data.trendingTokens.length > 0) {
        newListings = data.data.trendingTokens.slice(0, 3).map((token: any, index: number) => ({
          id: token.id,
          name: token.name,
          symbol: token.symbol,
          price: token.price,
          priceUsd: `$${token.price.toLocaleString()}`,
          change24h: token.change,
          volume24h: 5000000 + Math.random() * 10000000,
          volumeUsd: `$${(5 + Math.random() * 10).toFixed(2)}M`,
          marketCap: 500000000 + Math.random() * 1000000000,
          marketCapUsd: `$${(0.5 + Math.random() * 1).toFixed(2)}B`,
          chainId: "1",
          chain: Math.random() > 0.5 ? "ethereum" : "binance-smart-chain",
          address: `0x${Math.random().toString(16).substring(2, 42)}`,
          logo: `https://assets.coingecko.com/coins/images/${Math.floor(Math.random() * 20) + 100}/large/coin.png`,
          color: token.color,
          rank: 50 + index,
          trending: "up"
        }))

        highVolume = data.data.trendingTokens.slice(0, 3).map((token: any, index: number) => ({
          id: token.id,
          name: token.name,
          symbol: token.symbol,
          price: token.price,
          priceUsd: `$${token.price.toLocaleString()}`,
          change24h: token.change,
          volume24h: 50000000 + Math.random() * 100000000,
          volumeUsd: `$${(50 + Math.random() * 100).toFixed(2)}M`,
          marketCap: 5000000000 + Math.random() * 10000000000,
          marketCapUsd: `$${(5 + Math.random() * 10).toFixed(2)}B`,
          chainId: "1",
          chain: Math.random() > 0.3 ? "ethereum" : "solana",
          address: `0x${Math.random().toString(16).substring(2, 42)}`,
          logo: `https://assets.coingecko.com/coins/images/${Math.floor(Math.random() * 20) + 200}/large/coin.png`,
          color: token.color,
          rank: 10 + index,
          trending: Math.random() > 0.3 ? "up" : "down"
        }))
      }
    }

    // 如果没有实际数据，使用模拟数据
    if (trendingTokens.length === 0) {
      const mockData = generateMockData();
      trendingTokens = mockData.trending;
      newListings = mockData.newListings;
      highVolume = mockData.highVolume;
    }

    // 返回成功响应
    return NextResponse.json({
      success: true,
      data: {
        trending: trendingTokens,
        newListings: newListings,
        highVolume: highVolume,
        lastUpdated: new Date().toISOString()
      }
    })
  } catch (error) {
    console.error('API Error:', error)
    
    // 返回模拟数据以避免 UI 崩溃
    const mockData = generateMockData();
    
    return NextResponse.json({
      success: true,
      data: mockData
    })
  }
}
